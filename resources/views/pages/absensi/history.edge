<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Riwayat Absensi - Sistem Manajemen Karyawan
    </title>
    @vite(['resources/css/app.css', 'resources/js/app.js'])
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        min-height: 100vh;
        color: white;
        position: relative;
        overflow-x: hidden;
      }
      
      body::before {
        content: '';
        position: fixed;
        width: 400px;
        height: 400px;
        background: radial-gradient(circle, rgba(255,255,255,0.03) 0%, transparent 70%);
        top: -200px;
        right: -200px;
        animation: float 10s ease-in-out infinite;
      }
      
      @keyframes float {
        0%, 100% {
          transform: translateY(0);
        }
      
        50% {
          transform: translateY(-20px);
        }
      }
      
      nav {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(16px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
      }
      
      nav .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 64px;
      }
      
      nav .logo {
        font-size: 20px;
        font-weight: 700;
        color: white;
        text-decoration: none;
      }
      
      nav .nav-links {
        display: flex;
        gap: 32px;
        align-items: center;
      }
      
      nav .nav-links a {
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        transition: color 0.2s;
        padding: 8px 0;
        border-bottom: 2px solid transparent;
      }
      
      nav .nav-links a:hover,
      nav .nav-links a.active {
        color: white;
        border-bottom-color: rgba(255, 255, 255, 0.5);
      }
      
      nav .user-section {
        display: flex;
        align-items: center;
        gap: 16px;
      }
      
      nav .badge {
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        background: rgba(255, 255, 255, 0.15);
      }
      
      nav button {
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.6);
        font-size: 14px;
        cursor: pointer;
        transition: color 0.2s;
      }
      
      nav button:hover {
        color: white;
      }
      
      .main-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 32px 20px;
      }
      
      .alert {
        padding: 14px 16px;
        border-radius: 12px;
        margin-bottom: 24px;
        font-size: 14px;
        backdrop-filter: blur(10px);
      }
      
      .alert-success {
        background: rgba(76, 175, 80, 0.15);
        border: 1px solid rgba(76, 175, 80, 0.3);
        color: #a5d6a7;
      }
      
      .alert-error {
        background: rgba(255, 100, 100, 0.15);
        border: 1px solid rgba(255, 100, 100, 0.2);
        color: #ffcccc;
      }
      
      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 32px;
      }
      
      .page-header h1 {
        font-size: 28px;
        font-weight: 600;
        margin-bottom: 6px;
      }
      
      .page-header p {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.6);
      }
      
      .btn-back {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 18px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        transition: all 0.2s;
      }
      
      .btn-back:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-1px);
      }
      
      .filter-container {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 24px;
      }
      
      .filter-title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 16px;
        color: rgba(255, 255, 255, 0.8);
      }
      
      .filter-form {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        align-items: end;
      }
      
      .form-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      
      .form-label {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.7);
        font-weight: 500;
      }
      
      .form-input,
      .form-select {
        padding: 10px 12px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: white;
        font-size: 14px;
        transition: all 0.2s;
      }
      
      .form-input:focus,
      .form-select:focus {
        outline: none;
        border-color: rgba(255, 255, 255, 0.3);
        background: rgba(255, 255, 255, 0.08);
      }
      
      .btn-filter {
        padding: 10px 20px;
        background: rgba(33, 150, 243, 0.9);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .btn-filter:hover {
        background: rgba(33, 150, 243, 1);
        transform: translateY(-1px);
      }
      
      .btn-reset {
        padding: 10px 20px;
        background: transparent;
        color: rgba(255, 255, 255, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        transition: all 0.2s;
        display: inline-block;
        text-align: center;
      }
      
      .btn-reset:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.3);
      }
      
      .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
      }
      
      .stat-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 20px;
        text-align: center;
      }
      
      .stat-value {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 4px;
      }
      
      .stat-label {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.6);
      }
      
      .table-container {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        overflow: hidden;
        margin-bottom: 24px;
      }
      
      table {
        width: 100%;
        border-collapse: collapse;
      }
      
      thead {
        background: rgba(255, 255, 255, 0.05);
      }
      
      th {
        padding: 16px 20px;
        text-align: left;
        font-size: 13px;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.7);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      td {
        padding: 16px 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        font-size: 14px;
      }
      
      tbody tr {
        transition: background 0.2s;
      }
      
      tbody tr:hover {
        background: rgba(255, 255, 255, 0.03);
      }
      
      .status-badge {
        display: inline-block;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
      }
      
      .status-present {
        background: rgba(76, 175, 80, 0.2);
        color: #a5d6a7;
        border: 1px solid rgba(76, 175, 80, 0.3);
      }
      
      .status-late {
        background: rgba(255, 152, 0, 0.2);
        color: #ffcc80;
        border: 1px solid rgba(255, 152, 0, 0.3);
      }
      
      .status-absent {
        background: rgba(244, 67, 54, 0.2);
        color: #ef9a9a;
        border: 1px solid rgba(244, 67, 54, 0.3);
      }
      
      .status-holiday {
        background: rgba(168, 85, 247, 0.2);
        color: #d8b4fe;
        border: 1px solid rgba(168, 85, 247, 0.3);
        margin-right: 8px;
      }
      
      .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 12px;
      }
      
      .pagination a,
      .pagination span {
        padding: 10px 16px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: white;
        text-decoration: none;
        font-size: 14px;
        transition: all 0.2s;
      }
      
      .pagination a:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.2);
      }
      
      .pagination .active {
        background: rgba(33, 150, 243, 0.3);
        border-color: rgba(33, 150, 243, 0.5);
      }
      
      .empty-state {
        padding: 60px 20px;
        text-align: center;
        color: rgba(255, 255, 255, 0.5);
      }
      
      .empty-state svg {
        width: 64px;
        height: 64px;
        margin-bottom: 16px;
        opacity: 0.3;
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav>
      <div class="container">
        <a
          href="{{ user.role === 'admin' ? route('dashboard.index') : route('absensi.index') }}"
          class="logo"
        >Manajemen Karyawan</a>
        <div class="nav-links">
          @if(user.role === 'admin')
            <a href="{{ route('dashboard.index') }}">Dashboard</a>
            <a href="{{ route('employees.index') }}">Karyawan</a>
            <a href="{{ route('absensi.history') }}" class="active">History Absensi</a>
            <a href="{{ route('holidays.index') }}">Hari Libur</a>
            <a href="{{ route('employees.create') }}">Tambah Karyawan</a>
          @else
            <a href="{{ route('absensi.index') }}">Absensi</a>
            <a href="{{ route('absensi.history') }}" class="active">History</a>
            <a href="{{ route('holidays.employee') }}">Hari Libur</a>
            <a href="{{ route('employees.profile') }}">Profile</a>
          @end
        </div>
        <div class="user-section">
          <span>{{ user.name }}</span>
          @if(user.role === 'admin')
            <span class="badge">Admin</span>
          @else
            <span class="badge">Employee</span>
          @end
          <form action="{{ route('auth.logout') }}" method="POST" style="display: inline;">
            {{ csrfField() }}
            <button type="submit">Logout</button>
          </form>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">
      <!-- Alerts -->
      @if(flashMessages.has('success'))
        <div class="alert alert-success">
          {{ flashMessages.get('success') }}
        </div>
      @end
      
      @if(flashMessages.has('error'))
        <div class="alert alert-error">
          {{ flashMessages.get('error') }}
        </div>
      @end
      
      <!-- Page Header -->
      <div class="page-header">
        <div>
          <h1>
            Riwayat Absensi
          </h1>
          <p>
            Total {{ total }} record ditemukan
          </p>
        </div>
        @if(user.role !== 'admin')
          <a href="{{ route('absensi.index') }}" class="btn-back">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />

            </svg>
            Kembali
          </a>
        @endif
      </div>

      <!-- Filters -->
      <div class="filter-container">
        <div class="filter-title">
          Filter Pencarian
        </div>
        <form action="{{ route('absensi.history') }}" method="GET" class="filter-form">
          @if(user.role === 'admin')
            <div class="form-group">
              <label class="form-label">Karyawan</label>
              <select name="employee_id" class="form-select">
                <option value="">
                  Semua Karyawan
                </option>
                @each(emp in employees)
                  <option value="{{ emp._id }}" {{ filters.employee_id === String(emp._id) ? 'selected' : '' }}>
                    {{ emp.name }}
                  </option>
                @end
              </select>
            </div>
          @end
            
          <div class="form-group">
            <label class="form-label">Tanggal Mulai</label>
            <input type="date" name="start_date" class="form-input" value="{{ filters.start_date || '' }}" />
          </div>

          <div class="form-group">
            <label class="form-label">Tanggal Akhir</label>
            <input type="date" name="end_date" class="form-input" value="{{ filters.end_date || '' }}" />
          </div>

          <div class="form-group">
            <label class="form-label">Status</label>
            <select name="status" class="form-select">
              <option value="">
                Semua Status
              </option>
              <option value="present" {{ filters.status === 'present' ? 'selected' : '' }}>
                Hadir
              </option>
              <option value="late" {{ filters.status === 'late' ? 'selected' : '' }}>
                Terlambat
              </option>
              <option value="absent" {{ filters.status === 'absent' ? 'selected' : '' }}>
                Tidak Hadir
              </option>
              <option value="half-day" {{ filters.status === 'half-day' ? 'selected' : '' }}>
                Setengah Hari
              </option>
            </select>
          </div>

          <div class="form-group">
            <button type="submit" class="btn-filter">Filter</button>
          </div>

          <div class="form-group">
            <a href="{{ route('absensi.history') }}" class="btn-reset">Reset</a>
          </div>
        </form>
      </div>

      <!-- Attendance Table -->
      <div class="table-container">
        @if(attendances.length > 0)
          <table>
            <thead>
              <tr>
                @if(user.role === 'admin')
                  <th>
                    Karyawan
                  </th>
                @end
                <th>
                  Tanggal
                </th>
                <th>
                  Check-in
                </th>
                <th>
                  Check-out
                </th>
                <th>
                  Durasi Kerja
                </th>
                <th>
                  Status
                </th>
                @if(user.role === 'admin')
                  <th>
                    Catatan
                  </th>
                @end
              </tr>
            </thead>
            <tbody>
              @each(record in attendances)
                <tr>
                  @if(user.role === 'admin')
                    <td>
                      <div style="font-weight: 600;">
                        {{ record.employee_id.name }}
                      </div>
                      <div style="font-size: 12px; color: rgba(255,255,255,0.5);">
                        {{ record.employee_id.position }}
                      </div>
                    </td>
                  @end
                  <td>
                    {{ new Date(record.date).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' }) }}
                  </td>
                  <td>
                    {{ new Date(record.check_in).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' }) }}
                  </td>
                  <td>
                    {{ record.check_out ? new Date(record.check_out).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' }) : '-' }}
                  </td>
                  <td>
                    @if(record.work_duration)
                      {{ Math.floor(record.work_duration / 60) }}j {{ record.work_duration % 60 }}m
                    @else
                      -
                    @end
                  </td>
                  <td>
                    @if(record.holiday)
                      <span class="status-badge status-holiday" title="{{ record.holiday.name }}">
                        üéâ Hari Libur
                      </span>
                    @endif
                    @if(record.status === 'present')
                      <span class="status-badge status-present">Hadir</span>
                    @elseif(record.status === 'late')
                      <span class="status-badge status-late">Terlambat ({{ record.late_duration }}m)</span>
                    @elseif(record.status === 'absent')
                      <span class="status-badge status-absent">Tidak Hadir</span>
                    @else
                      <span class="status-badge">{{ record.status }}</span>
                    @end
                  </td>
                  @if(user.role === 'admin')
                    <td>
                      {{ record.notes || '-' }}
                    </td>
                  @end
                </tr>
              @end
            </tbody>
          </table>
        @else
          <div class="empty-state">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              />

            </svg>
            <p>
              Tidak ada data absensi
            </p>
          </div>
        @end
      </div>

      <!-- Pagination -->
      @if(totalPages > 1)
        <div class="pagination">
          @if(currentPage > 1)
            <a
              href="{{ route('absensi.history') }}?page={{ currentPage - 1 }}&start_date={{ filters.start_date }}&end_date={{ filters.end_date }}&status={{ filters.status }}&employee_id={{ filters.employee_id }}"
            >
              ‚Üê Previous
            </a>
          @end
            
          @set('startPage', Math.max(1, currentPage - 2))
            @set('endPage', Math.min(totalPages, currentPage + 2))

              @each(p in Array.from({ length: endPage - startPage + 1 }, (_, i) => startPage + i))
                @if(p === currentPage)
                  <span class="active">{{ p }}</span>
                @else
                  <a
                    href="{{ route('absensi.history') }}?page={{ p }}&start_date={{ filters.start_date }}&end_date={{ filters.end_date }}&status={{ filters.status }}&employee_id={{ filters.employee_id }}"
                  >
                    {{ p }}
              </a>
                @end
              @end
                
              @if(currentPage < totalPages)
                <a
                  href="{{ route('absensi.history') }}?page={{ currentPage + 1 }}&start_date={{ filters.start_date }}&end_date={{ filters.end_date }}&status={{ filters.status }}&employee_id={{ filters.employee_id }}"
                >
                  Next ‚Üí
            </a>
              @end
            </div>
          @end
        </div>
      </body>
    </html>
